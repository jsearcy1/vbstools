%\section{Introduction}
The discovery of a Higgs-like boson at the
LHC~\cite{ATLAS_higgs,CMS_higgs} was the first step toward a better
understanding of the electroweak symmetry breaking (EWSB)
mechanism. One important, and unverified, prediction of the Standard
Model (SM) is that the scattering amplitude of longitudinal vector
bosons ($V_{L}V_{L} \rightarrow V_{L}V_{L}$) is unitarized by the
Higgs boson.  Measuring VBS processes at a hadron collider, however,
is experimentally challenging. The ATLAS and CMS collaborations
recently provided the first evidence for and study of a VBS process
using events with two same-electric-charge $W$ bosons in association
with two forward jets ($pp \to$ \ssWW)~\cite{ATLAS_ssWW,CMS_ssWW}.
This final state has the advantage of relatively small SM background
contributions compared to other VBS processes, paired with a
production rate large enough to measure in early LHC datasets.  While
an ideal candidate for first observation of the VBS process, measuring
the longitudinal fraction of these events is not straight forward.

In general the polarization of a gauge boson can be determined from
the angular distribution of its decay products.  Since a $W$ boson
only couples to left-handed particles and right-handed anti-particles, the decayed
charged lepton is expected to preferentially pointing along the boson
direction of motion for a left-handed $W^+$ and along the opposite boson direction of motion 
for a left-handed $W^-$. The normalized differential cross section of a
leptonically-decaying $W$ boson can be written in terms of
polarization fractions as~\cite{bla}:
\begin{multline}
 \frac{1}{\sigma} \frac{d\sigma}{d\cts} = \frac{3}{8} f_- (1 \mp \cts)^2 + \frac{3}{8} f_+ (1 \pm \cts)^2 \\ 
+\frac{3}{4} f_L (1 - \ctsSq) , {\text {for~}} W^\pm 
\end{multline}
%  R. Ellis, W. Stirling, and B. Webber, QCD and collider physics
%, Camb. Monogr. Part. Phys. Nucl. Phys. Cosmol. 8 (1996) 1
where \ts is the angle between the charged lepton in the boson
rest frame and the $W$ boson direction of motion.  Fraction
parameters $f_{-}$, $f_{+}$ and $f_L$ denote the fractions of $W$
events with three possible polarization states $-1$, $+1$ and 0,
respectively.  They are constrained via $f_- + f_+ + f_L = 1$.  In
order to measure \ts, we need to fully reconstruct the direction of
motion of the $W$ boson.

Requiring both $W$ bosons to decay leptonically in the $pp
\to$ \ssWW events enables the determination of the electric charge of
each $W$ boson via the charged leptons. However, the
corresponding two neutrinos in the final state are not detected, the
$W$ boson rest frames cannot be directly measured.  It is thus
difficult to determine polarization fractions of each boson and
the fraction of longitudinal scattering events in the \ssWW process.

Many proposals have been made to determine the longitudinal fractions in other VBS final states, such as semi-leptonic
$W^+W^-$~\cite{Han:2009em}, $W^\pm Z$~\cite{aa} and $ZZ$~\cite{le houche report} or
fully-leptonic decay modes of $W^\pm Z$ and $ZZ$, where the full
event kinematics can be reconstructed or estimated using the $W$ boson mass constraint. 
However, these channels either suffer from large SM backgrounds not present in the \ssWW channel or
have relatively low production cross sections. Attempts have been made
to gain sensitivity through other variables than \ts in the \ssWW
channel~\cite{aaa}. One example is the variable $R_{p_T}=(p_{T}^{\ell 1} \times
p_{T}^{\ell 2}) / (p_T^{j_1} \times p_T^{j_2})$~\cite{Doroba:2012pd},
where $\ell_1$ and $\ell_2$ denote the two leptons in no particular
order and $j_1$ and $j_2$ denote the two most energetic jets in the
event.  It is natural to assume that not all of the sensitivity to
longitudinal scattering is encompassed in a single variable, and that
better discrimination could be obtained by combining the available
event information with a machine learning technique. In this paper we
develop a method to use a neural network to map measurable quantities
to the true \cts values that contain the events polarization information.

%\section{Machine learning model}
While it has become common practice in high energy physics to use
multi-variate techniques to separate signal from background, to the
author's knowledge multi-variate regression has not been used to
directly predict underlying quantities {\bf also not in H
  properties?}.  Recent success with deep learning in other areas of
HEP are presented in~\cite{Baldi:2014kfa,Baldi:2014pta}.

For the \ssWW events, we use representative measurable quantities such
as the transverse momentum ($p_T$)~\cite{coordinate}, pseudorapidity ($\eta$) and
azimuthal angle ($\phi$) of the two leptons and two jets, and $x$- and $y$-components 
of missing transverse energy ($\slashed{E}_T^x$ and
$\slashed{E}_T^y$).  The overall number of measurable quantities used is 14. 
The goal of the multi-variate technique is to find
the best mapping from these measurable quantities to the two truth
values of \cts (one for each $W$ boson) present in each event.  We
choose a multi-layer neural network with a final output layer with
linear activation. The neural network is implemented with the Theano
software packages~\cite{theano}. Hyper-parameters are tuned by hand,
but undoubtedly could be improved.  The cost function is defined as 
${\cal{C}}= \sum_{i=1}^{N} [(\ctsnb_{1,i} -\cos \theta^{NN}_{1,i})^2+(\ctsnb_{2,i}-\cos \theta^{NN}_{2,i})^2]/N$, 
where $N$ is the number of events per mini-batch,
$\ctsnb_{1/2,i}$ is the truth value of \cts for each $W$ boson with
random ordering for the $i$-th event, and $\cos \theta^{NN}_{1/2, i}$ is the value of
the two neural network outputs. Stochastic gradient descent
algorithm~\cite{sgd} is used to train the neural network.

Signal \ssWW events are generated using the {\sc madgraph} event generator~\cite{madgraph} at a proton-proton center-of-mass energy of 13 TeV.  
The NN23l01 {\bf find more correct name for this PDF set} parton distribution function~\cite{pdf} is used as the default. 
The following selection criteria are applied during the event generation: outgoing parton $p_T > 20$ GeV and $|\eta| < 5$, 
lepton $p_T > 10$ GeV and $|\eta| < 2.5$, and the invariant mass of the two outgoing partons must be greater than 150 GeV. The resulting cross section at 13~TeV is 8.4~fb, which is used to normalize the expected number of signal events{\bf why did we remove this?}.
To emulate the response of a typical general-purpose LHC detector, these events are parton-showered using {\sc pythia}\cite{pythia} and passed through the 
response simulation of the CMS {\bf it really is the CMS detector not ATLAS} detector implemented in {\sc delphes}~\cite{delphes}. {\bf mention jet alg/size etc. here} Events
are split into three categories: 1/4 are used in a training sample,
1/4 are used for a validation test against over-training, and the
remaining 1/2 are used to build templates and perform sensitivity
studies. A ** layer neural network with ** hidden neurons and a
learning rate of ** is used {\bf I can move thie earlier, but I also didn't use a fixed learning rate }.

The dominant background {\bf only true for ATLAS} to the \ssWW process comes from the $WZjj$ process where one of 
the leptons from the $Z$ boson decay is not detected or reconstructed. We also use the 
{\sc madgraph} event generator to produce $WZjj$ events.

%\section{\label{sec:signal} Signal Model}
Polarization fractions can then be obtained by experimentally fitting the two-dimensional distribution of the NN output \ctsNN.  
In order to fit for these polarization fractions templates must be built for ``pure'' polarization states. These
templates are created by reweighting each event based on the truth
\cts distribution. The event weight $W_i$ for polarization state $i$ is given by
$W_i = F_i/n$, where $n$ is used for the normalization and is
defined as
\begin{multline}
n=[ \frac{3}{8} f_- (1 \mp \ctsnb_1)^2 + \frac{3}{8} f_+ (1 \pm \ctsnb_1)^ 2 +\frac{3}{4} f_L (1 - \ctsSqnb_1)] \\
\times [ \frac{3}{8} f_- (1 \mp \ctsnb_2)^2 + \frac{3}{8} f_+ (1 \pm \ctsnb_2)^ 2 +\frac{3}{4} f_L (1 - \ctsSqnb_2)]. 
\end{multline}
The index $i$ represents one of six possible polarization states for the two
$W$ bosons: Left-Left ($--$), Left-Right ($-+$), Right-Right($++$),
Left-Longitudinal ($-L$), Right-Longitudinal ($+L$), or
Longitudinal-Longitudinal ($LL$) {\bf no reason to name them Left/Right if we are using +/-}. $F_i$ is defined as \small
\begin{equation}
F_i \in  \left( \begin{array}{c} 
  --=f_-^2 (1 \mp \ctsnb_1)^2(1 \mp \ctsnb_2)^2,\\
  -+=f_- f_+[ (1 \mp \ctsnb_1)^2(1 \pm \ctsnb_2)^2\\ \;\;+(1 \pm \ctsnb_1)^2 (1 \mp \ctsnb_2)^2],\\
  ++=f_+^2 (1 \pm \ctsnb_1)^2(1 \pm \ctsnb_2)^2,\\
  -L=f_- f_L[ (1 \mp \ctsnb_1)^2(1 - \ctsSqnb_2)\\  \;\;+(1 - \ctsSqnb_1))(1 \mp \ctsnb_2)^2 ],\\
  +L=f_+ f_L[ (1 \pm \ctsnb_1)^2 (1 - \ctsSqnb_2))\\  \;\;+(1 - \ctsSqnb_1)(1 \pm \ctsnb_2)^2 ],\\
  LL=f_L^2 (1 - \ctsSqnb_1))(1 - \ctsSqnb_2)\\
\end{array} \right).
\end{equation}
\normalsize Since no ordering is applied to the two bosons we require
that the individual polarization fractions $f_-$,$f_+$,$f_L$ are the
same for both $W$ bosons.  For reweighting the original sample $f_-$,
$f_+$, $f_L$ are take as a function of the invariant mass of the
diboson system ($M_{WW}$).  Weights are calculated before any
additional event level cuts are made, and the resulting templates are
remade for each set of cuts explored.  
%To validate the reweighting procedure, we also generate pure polarization state samples using {\sc
%  madspin} and compare the obtained events kinematics with those
%obtained from the reweighted sample. 
{\bf Does this mean you got the
  MG5 scripts to work and add the helicity to the lhe? A. No this was never done removed this.}
 
Figure~\ref{fig:polarization_comparison}(a) shows the comparison between the truth \cts and 
the NN output \ctsNN for $--$, $++$ and $LL$ events ( $-+/L+/L-$ are omiited for clearity but closely resemble combinations of the templates shown). As expected, \ctsNN has less seperation 
power to different polarization states compared to \cts due to missing information for the two final state neutrinos. 
However, reasonable discrimination between each polarization state can clearly be seen from these distributions. 
Figure~\ref{fig:polarization_comparison}(b) shows the $R_{p_T}$ distribution for $--$, $++$, and $LL$ events. 
The discrimination power is seen only for large values of $R_{p_T}$, and only apparent with a logorithm scale.

Figure~\ref{fig:polarization_comparison}(c) shows the \ctsNN distribution between the signal \ssWW process and the background $WZjj$ process. 
Reasonable separation power can be found. In actual data analysis, component would be subtracted as background from observed data before fitting for the polarization fractions. 

\begin{figure*}
\includegraphics[width=.32\textwidth]{./fig/1d_templates_graph_X.pdf}
\includegraphics[width=.32\textwidth]{./fig/ratios_LLRROO_graph.pdf}
\includegraphics[width=.32\textwidth]{./fig/1d_wz_bg_graph_X.pdf}
\caption{\label{fig:polarization_comparison} Comparison of the truth level \cts and the 
NN output \ctsNN distributions for $--$, $++$ and $LL$ events (Left), 
$R_{p_T}$ templates for the corresponding polarization states (Middle), 
and comparison of the \ctsNN for the signal and dominant $WZjj$ background (Right).}
\end{figure*}

%\section{Results}
Having established templates for each polarization state and a
distribution that is sensitive to different polarization states, all
we have to do is fit the two-dimensional $\ctsNN_1$ vs $\ctsNN_2$
distribution in data to derive each polarization fraction. Five equal-size bins 
are used for each \ctsNN variable ranging from -1 to 1. A maximum likelihood fit is performed 
within the RooFit framework~\cite{aa}. Fit uncertainties are determined by randomly
fluctuating data expectations within their Poisson errors and
repeating the fit, and confidence intervals are derived from these toy experiments.  
{\bf (need to put more description here about 68\% and 95\% level limits)}
%To validate the fitting method, we also make sure the
%fitted values for each fraction agree with with the values obtained at
%the truth level. {\bf transition from truth level templates to reco
%  level dists not clear; where has NN been used?}

%There are six possible polarization states for the two colliding $W$ bosons. 
We combine events with both $W$ bosons transversely-polarized as
``$TT$'' (the sum of $--$, $-+$ and $++$ combinations), events with
one $W$ boson transversely-polarized and one $W$ boson
longitudinally-polarized as ``$TL$'' (the sum of $-L$ and $+L$
combinations), and events with both $W$ bosons
longitudinally-polarized as ``$LL$''. This reduces the free fitting parameters from 5 to 2 and 
allows for a better constraint on the $LL$ scattering fraction of interest, under the assumption that
the relative admixture of contributions within $TT$ and $TL$ does not change. 

Figure~\ref{fig:fit_example} shows one example fit where the pseudo data are compared to the sum of 
contributions from $TT$, $TL$ and $LL$ components. A total integrated luminosity of 1 ab$^{-1}$ is assumed.  

\begin{figure}[h]
\includegraphics[width=.49\textwidth]{./fig/NN_fit_3.pdf}
\caption{\label{fig:fit_example} One example fit where the pseudo data are compared to the sum of 
contributions from $TT$, $TL$ and $LL$ components. There are five groups with five bins inside each group. 
These five groups represent $\ctsNN_2$ from -1 to 1 with a step size of 0.4, while five bins inside each group represent $\ctsNN_1$ from -1 to 1 with a step size of 0.4.}
\end{figure}

Studies shown above are performed using all events at the parton level  
and show the encouraging results to use neutral network to recover the lepton angular information and improve the separation between different polarization states. 
It is important to also check if this procedure will stand up to experimental realities of finite detector resolution. 
To further reduce SM backgrounds, we apply additional selection criteria as used by the ATLAS collaboration~\cite{ATLAS_ssWW} to obtain a
tighter fiducial region which is dominated by the contribution from electroweak production of \ssWW events: jet $p_T > 30$ GeV, lepton $p_T > 25$ GeV, missing transverse energy $\slashed{E}_T > 40$ GeV, 
dijet mass $M_{jj} > $500 GeV, and dijet pseudorapidity difference $|\Delta \eta_{jj}| > 2.4 $. 
If these criterias are applied at the generator level, jet $p_T$, $M_{jj}$ and $\Delta \eta_{jj}$ are calculated using the parton-level jets 
and $\slashed{E}_T$ are calculated using two generator-level neutrinos.

We determine the precision that can be achieved for fractions of $TT$, $TL$, and $LL$ components using four different scenarios: (a) using all  generated events at the parton level; 
(b) using events passed these additional selection criteria used by ATLAS at the parton level; 
(c) using all generated events passed through the {\sc delphes} simulation; and (d) using events passed through the {\sc delphes} simulation and 
also passed these additional selection criteria used by ATLAS. 
The precision for the three polarization fractions as a function of the integrated luminosity are presented in Fig.~\ref{fig:sensitivity}. 
 Transverse components can be measured with great precision, whereas separating pure longitudinal-longitudinal scattering from longitudinal-transverse scattering is challenging.
The precision for the $LL$ fraction is **\% (**\%) for an integrated luminosity of 100 (3000) fb$^{-1}$. {\bf from this plot it seems that we can not determine the LL fraction even using 3 ab-1, is that true?}

We also determine the precision  for $TT$, $TL$, and $LL$ fractions by fitting the $R_{p_T}$ distribution. 
The precision for the $LL$ fraction is found to be **\% (**\%) for an integrated luminosity of 100 (3000) fb$^{-1}$.
Better precision is obtained for $\ctsNN$, which indicates that it is a more sensitive variable to different polarization states than $R_{p_T}$.

\begin{figure*}
\includegraphics[width=.9\textwidth]{./fig/12_LL_LT_TT.pdf}
\caption{ \label{fig:sensitivity} Precisions for three polarization fractions as a function of the integrated luminosity for four scenarios discussed in the text.}
\end{figure*}

%\section{Conclusions}
In conclusion, we present a method to determine the $WW$ polarization fractions in
\ssWW events by using a deep machine learning technique.  This method
allows to recover the charged lepton angular distributions in the $W$
boson rest frame from measurable event kinematics.  We compare the
results obtained from this method and from other traditional methods
to illustrate the gain in sensitivity with our method.  Cuts to reject
backgrounds as well as finite detector resolutions reduces the sensitivity as
expected, but the method remains a useful tool for the study of
polarization fractions in VBS events.

\begin{thebibliography}{99}
\input{ref.tex}
\end{thebibliography}

